. util.sh

BAR
TEST
BAR
echo '[ U-01 ] root 계정 원격접속 제한'
OK "원격 터미널 서비스를 사용하지 않거나, 사용 시 root 직접 접속을 차단한 경우"
VULN "원격 터미널 서비스 사용 시 root 직접 접속을 허용한 경우"
BAR

# telnet 체크
SERVICE1=telnet.socket
systemctl is-active $SERVICE1 > /dev/null 2>&1

if [ $? = 0 ]; then
    INFO "텔넷 서비스가 활성화 되어 있습니다."
    VALUE1=$(cat /etc/securetty | grep "^pts" | wc -l)
    if [ $VALUE1 != 0 ]; then
        WARN "root 직접 접속을 허용하고 telnet을 사용중입니다."
    else
        OK "telnet을 사용하지 않거나, 직접 접속을 차단한 경우"
    fi
else
    OK "telnet 서비스가 비활성화 되어 있습니다."
fi
# ssh 체크
SERVICE1=sshd
systemctl is-active $SERVICE1 > /dev/null 2>&1


if [ $? = 0 ]; then
    INFO "SSH 서비스가 활성화 되어 있습니다."
    VALUE2=$(cat /etc/ssh/sshd_config | grep 'PermitRootLogin yes' | awk {'print $2'})    
    if [[ $VALUE2 = "yes" ]]; then
        VULN "SSH를 사용하고, 직접 접속을 허용하고 있습니다."
        cat /etc/ssh/sshd_config | grep "PermitRootLogin"
        echo "수정하겠습니다."
        sed -i 's/PermitRootLogin yes/PermitRootLogin no/g' /etc/ssh/sshd_config > /dev/null 2>&1
        echo "수정되었습니다."
        cat /etc/ssh/sshd_config | grep "PermitRootLogin"
        echo "sshd 서비스 재시작합니다."
        systemctl restart sshd > /dev/null 2>&1
    else
        OK "SSH를 사용하지 않거나, 직접 접속을 차단한 경우"
    fi
else
    OK "SSH 서비스가 비활성화 되어 있습니다."
fi
